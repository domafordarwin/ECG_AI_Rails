<% content_for :title, "Detailed Analysis Screen - CardioEdu Analytics" %>

<header class="fixed top-0 left-0 w-full bg-[#1e4c82] shadow-md z-50 h-16">
  <div class="container mx-auto px-4 h-full flex items-center justify-between">
    <div class="flex items-center cursor-pointer" onclick="window.location.href='/'">
      <svg class="w-8 h-8 text-white mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
      <span class="text-white text-xl font-bold tracking-tight">CardioEdu Analytics</span>
    </div>
    <nav class="hidden md:flex space-x-8 h-full items-center">
      <a class="text-blue-100 hover:text-white px-3 py-2 text-sm font-medium transition-colors" href="/">Dashboard</a>
      <a class="text-blue-100 hover:text-white px-3 py-2 text-sm font-medium transition-colors" href="/upload">Upload</a>
      <a class="text-white bg-blue-700 bg-opacity-50 px-3 py-2 text-sm font-medium rounded-md border-b-2 border-white" href="/detailed">Analysis</a>
    </nav>
    <div class="flex items-center">
      <button class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white">
        <div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-gray-700 font-bold text-sm border-2 border-blue-300">ST</div>
      </button>
    </div>
  </div>
</header>

<main class="pt-20 pb-8 px-4 sm:px-6 lg:px-8 max-w-[1600px] mx-auto bg-gray-100 min-h-screen" data-controller="upload">
  <div class="mb-6 flex justify-between items-end">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Detailed Analysis Screen</h1>
      <p class="text-sm text-gray-500 mt-1">Patient ID: #83920-A • Recording Date: <%= Time.current.strftime("%b %d, %Y") %></p>
    </div>
    <div class="flex gap-2">
       <button data-action="click->upload#downloadPDF" class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium hover:bg-gray-50 transition-colors">Export PDF</button>
       <button data-action="click->upload#downloadCSV" class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium hover:bg-gray-50 transition-colors">Export CSV</button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- Left Column: Waveform -->
    <section class="lg:col-span-8 flex flex-col gap-6">
      <article class="bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100">
        <div class="px-6 py-4 border-b border-gray-100 flex flex-wrap justify-between items-center bg-gray-50">
          <h2 class="text-lg font-semibold text-gray-800">Waveform Viewer</h2>
          <div class="flex items-center gap-4 mt-2 sm:mt-0">
            <div class="flex bg-white rounded-md shadow-sm border border-gray-200">
              <button data-action="click->upload#zoomIn" class="p-2 hover:bg-gray-50 border-r border-gray-200 text-gray-600" title="Zoom In"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></button>
              <button data-action="click->upload#zoomOut" class="p-2 hover:bg-gray-50 border-r border-gray-200 text-gray-600" title="Zoom Out"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></button>
              <button class="p-2 bg-blue-100 text-blue-800 border border-blue-200 font-medium text-xs px-3">Scan View</button>
            </div>
            <div class="hidden xl:flex items-center gap-3 text-[10px] font-bold text-gray-600 border-l pl-4 border-gray-200 ml-2">
              <div class="flex items-center gap-1"><span class="w-2.5 h-2.5 rounded-full bg-green-500"></span> P-start</div>
              <div class="flex items-center gap-1"><span class="w-2.5 h-2.5 rounded-full bg-red-500"></span> Q</div>
              <div class="flex items-center gap-1"><span class="w-2.5 h-2.5 rounded-full bg-blue-500"></span> R</div>
              <div class="flex items-center gap-1"><span class="w-2.5 h-2.5 rounded-full bg-orange-500"></span> S</div>
              <div class="flex items-center gap-1"><span class="w-2.5 h-2.5 rounded-full bg-purple-500"></span> T-end</div>
            </div>
          </div>
        </div>
        <div class="p-6">
           <div class="flex items-center justify-between mb-2">
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Master Navigation</span>
            <span class="text-xs font-black text-blue-700 px-2 py-0.5" data-upload-target="sliderLabel">0.000s ~ 5.000s</span>
          </div>
          <div class="mb-6 border border-gray-200 rounded-lg overflow-hidden relative bg-slate-50 h-[300px]">
             <canvas id="ecgChart"></canvas>
          </div>
          <div class="border border-gray-200 rounded-lg overflow-hidden relative bg-slate-50 h-[250px]">
             <canvas id="detailChart"></canvas>
          </div>
          <div class="pt-4">
             <input type="range" class="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                    data-upload-target="slider" data-action="input->upload#updateChartWindow" min="0" max="100" step="1" value="0">
          </div>
        </div>
      </article>
    </section>

    <!-- Right Column: Interpretation & Quality -->
    <section class="lg:col-span-4 flex flex-col gap-6">
      <article class="bg-white rounded-lg shadow-sm border border-gray-100">
        <div class="px-5 py-4 border-b border-gray-100 bg-gray-50">
          <h2 class="text-lg font-semibold text-gray-800">ECG Interpretation Diagram</h2>
        </div>
        <div class="p-5 space-y-5">
          <div class="flex justify-between gap-2">
            <div class="w-[48%] border border-gray-100 p-1 rounded">
              <img src="https://cdn-icons-png.flaticon.com/512/822/822143.png" class="max-w-full h-auto" alt="Heart Diagram">
            </div>
            <div class="w-[48%] border border-gray-100 p-1 rounded">
              <img src="https://cdn-icons-png.flaticon.com/512/3209/3209106.png" class="max-w-full h-auto" alt="ECG Cycle">
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div class="rounded-lg p-3 border border-blue-100 bg-blue-50">
              <div class="text-xs font-bold text-gray-500 uppercase">PQ Interval</div>
              <div class="text-lg font-black text-gray-800" data-type="pq-interval">120ms</div>
              <div class="text-[10px] text-green-600 font-bold uppercase">● Normal</div>
            </div>
            <div class="rounded-lg p-3 border border-blue-100 bg-blue-50">
              <div class="text-xs font-bold text-gray-500 uppercase">QT Interval</div>
              <div class="text-lg font-black text-gray-800" data-type="qt-interval">380ms</div>
              <div class="text-[10px] text-green-600 font-bold uppercase">● Normal</div>
            </div>
          </div>
        </div>
      </article>

      <article class="bg-white rounded-lg shadow-sm border border-gray-100">
        <div class="px-5 py-4 border-b border-gray-100 bg-gray-50">
          <h2 class="text-lg font-semibold text-gray-800">Quality/Noise Panel</h2>
        </div>
        <div class="p-5">
          <ul class="space-y-4 mb-6 text-sm">
            <li class="flex justify-between items-center">
              <span class="text-gray-600">Baseline Wander</span>
              <span class="px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs font-bold">Suspected</span>
            </li>
            <li class="flex justify-between items-center">
              <span class="text-gray-600">Powerline (50Hz)</span>
              <span class="px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs font-bold">Suspected</span>
            </li>
            <li class="flex justify-between items-center">
              <span class="text-gray-600">Electromyogram</span>
              <span class="px-2 py-0.5 bg-green-100 text-green-700 rounded text-xs font-bold">None</span>
            </li>
          </ul>
          <div class="border-t border-gray-100 pt-4">
            <button data-action="click->upload#submitToTeacher" class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold transition-all shadow-md active:scale-95">Send Analysis to Teacher</button>
          </div>
        </div>
      </article>
    </section>
  </div>
</main>
